<!doctype html>
<html lang="en-gb" class="no-js">
<head>
	<title>{{ club['name'] }}</title>

	<meta charset="utf-8">
	<meta name="keywords" content="" />
	<meta name="description" content="" />

	<!-- Favicon -->
	<link rel="shortcut icon" href="images/favicon.ico">

	<!-- this styles only adds some repairs on idevices  -->
	<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1" />

	<!-- ######### CSS STYLES ######### -->
	<link rel="stylesheet" href="{{ static_url('elos/css/reset.css') }}" type="text/css" />
	<link rel="stylesheet" href="{{ static_url('elos/css/style.css') }}" type="text/css" />
	<link rel="stylesheet" href="{{ static_url('weui/lib/weui.css') }}">
	<link rel="stylesheet" href="{{ static_url('elos/css/font-awesome/css/font-awesome.min.css') }}">
	<!-- responsive devices styles -->
	<link rel="stylesheet" media="screen" href="{{ static_url('elos/css/responsive-leyouts.css') }}" type="text/css" />

	<!-- mega menu -->
	<link href="{{ static_url('elos/js/mainmenu/sticky.css') }}" rel="stylesheet">
	<link href="{{ static_url('elos/js/mainmenu/bootstrap.css') }}" rel="stylesheet">
	<link href="{{ static_url('elos/js/mainmenu/fhmm.css') }}" rel="stylesheet">
	<!-- REVOLUTION SLIDER -->
	<link rel="stylesheet" type="text/css" href="{{ static_url('elos/js/revolutionslider/rs-plugin/css/settings.css') }}" media="screen" />
	<link rel="stylesheet" type="text/css" href="{{ static_url('elos/js/revolutionslider/css/slider_main.css') }}" media="screen" />
	<!-- cubeportfolio -->
	<link rel="stylesheet" type="text/css" href="{{ static_url('elos/js/cubeportfolio/cubeportfolio.min.css') }}">
	<!-- tabs -->
	<link rel="stylesheet" type="text/css" href="{{ static_url('elos/js/tabs/assets/css/responsive-tabs3.css') }}">
  <link rel="stylesheet" type="text/css" href="{{ static_url('elos/js/tabs/tabwidget/tabwidget.css') }}" />
	<!-- carousel -->
	<link rel="stylesheet" href="{{ static_url('elos/js/carousel/flexslider.css') }}" type="text/css" media="screen" />
	<link rel="stylesheet" type="text/css" href="{{ static_url('elos/js/carousel/skin.css') }}" />
	<!-- accordion -->
	<link rel="stylesheet" href="{{ static_url('elos/js/accordion/accordion.css') }}" type="text/css" media="all">
	<!-- Lightbox -->
	<link rel="stylesheet" type="text/css" href="{{ static_url('elos/js/lightbox/jquery.fancybox.css') }}" media="screen" />
	<script src="{{ static_url('elos/js/style-switcher/jquery-1.js') }}"></script>
</head>

<body>


	<div class="wrapper_boxed">

		<div class="site_wrapper">

			<!-- top header bar -->
			{% module Template("elos/block-header.html", club=club, categories=categories, is_login=is_login) %}
			<!-- /top header bar -->

			<div class="clearfix"></div>
			<div class="page_title2">
				<div class="container">

					<div class="title">
						<h1>Blog   </h1></div>

					<div class="pagenation">&nbsp;<a href="/elos/clubs/{{ club['_id'] }}/blogs">首页</a> <i>/</i> <a href="#">博客</a> <i>/</i> 文章页</div>

				</div>
			</div>
			<!-- end page title -->


			<div class="clearfix"></div>

			<div class="container">

				<div class="content_left">

					<div class="blog_post">
						<div class="blog_postcontent">
							<div class="image_frame">
								<a href="#"><img src="{{ article['img'] }}!800x370" alt="" /></a>
							</div>
							<a href="#" class="date" id="a_date"></a>
							<h3><a href="＃">{{ article['title'] }}</a></h3>
							<ul class="post_meta_links">
								<li class="post_by"><a href="#">{{ article['nickname'] }}</a></li>
								<li class="post_comments"><a href="#">{{ article['comment_num'] }} 条评论</a></li>
                <li class="post_edit"><a href="/elos/clubs/{{club['_id']}}/articles/{{article['_id']}}/edit">编辑</a></li>
							{% if article['_status'] != 100 %}
								<li class="post_categoty"><a href="#" id="pub_btn">发布</a></li>
							{% end %}
							</ul>

							<div class="post_info_content">
								<p>{{ article['subtitle'] }}</p>
							</div>
							<div class="post_info_content">
								<p>{% raw article['paragraphs'] %}</p>
							</div>
						</div>
					</div>
					<!-- /# end post -->

					<div class="clearfix divider_dashed9"></div>



					<div id="comment_wrap">
							<h4>评论内容</h4>
							<div class="mar_top_bottom_lines_small3"></div>
							<div class="comment_wrap" v-for="comment in comments">
								<div class="gravatar">
									<img style="width:30px;height:30px;" v-bind:src="comment.avatar" alt="" />
								</div>
								<div class="comment_content">
									<div class="comment_meta">

										<div class="comment_author">{{! comment.nickname }} - <i>{{! comment.create_time }}</i></div>

									</div>
									<div class="comment_text">
										<p>{{! comment.comment }}</p>
									</div>
								</div>
							</div>
							<!-- end section -->


							<div class="comment_form">
								<h4>添加评论</h4>
									<textarea id="comment" class="comment_textarea_bg" rows="20" cols="7" placeholder="添加评论内容" ></textarea>
									<div class="clearfix"></div>
									<div class="send-ok-message"></div>
									<input name="send" type="submit" value="评论" class="comment_submit" v-on:click="sendComment" />
							</div>
					</div>
					<!-- end comment form -->

					<div class="clearfix divider_dashed9"></div>

					<div class="clearfix mar_top2"></div>

					<!-- <div class="sharepost">
						<h4>Share this Post</h4>
						<ul>
							<li><a href="#">&nbsp;<i class="fa fa-facebook fa-lg"></i>&nbsp;</a></li>
							<li><a href="#"><i class="fa fa-twitter fa-lg"></i></a></li>
							<li><a href="#"><i class="fa fa-google-plus fa-lg"></i></a></li>
							<li><a href="#"><i class="fa fa-flickr fa-lg"></i></a></li>
							<li><a href="#"><i class="fa fa-dribbble fa-lg"></i></a></li>
							<li><a href="#"><i class="fa fa-html5 fa-lg"></i></a></li>
							<li><a href="#"><i class="fa fa-skype fa-lg"></i></a></li>
							<li><a href="#"><i class="fa fa-youtube fa-lg"></i></a></li>
							<li><a href="#"><i class="fa fa-linkedin fa-lg"></i></a></li>
							<li><a href="#"><i class="fa fa-pinterest fa-lg"></i></a></li>
							<li><a href="#"><i class="fa fa-linux fa-lg"></i></a></li>
							<li><a href="#"><i class="fa fa-android fa-lg"></i></a></li>
							<li><a href="#"><i class="fa fa-rss fa-lg"></i></a></li>
						</ul>

					</div> -->
					<!-- end share post links -->

					<div class="clearfix"></div>

					<h4>关于博主</h4>
					<div class="about_author">

						<img src="{{ article['avatar'] }}!200x200" alt="" />

						<a href="#" target="_blank">{{ article['nickname'] }}</a><br /> I'm a freelance designer with satisfied clients worldwide. I design simple,
						 clean websites and develop easy-to-use applications. Web Design
						is not just my job it's my passion. You need professional web designer you are welcome.
					</div>
					<!-- end about author -->


				</div>
				<!-- end content left side -->

				<!-- right sidebar starts -->
				<div class="right_sidebar">

					<div class="site-search-area">

						<form id="site-searchform">
							<div>
								<input class="input-text" name="s" id="s" value="关键词..." onFocus="if (this.value == '关键词...') {this.value = '';}" onBlur="if (this.value == '') {this.value = '关键词...';}" type="text" />
								<input id="searchsubmit" value="Search" type="button" />
							</div>
						</form>

					</div>
					<!-- end site search -->

					<div class="clearfix margin_top4"></div>

					<!-- sidebar category widget -->
					{% module Template("elos/block-sidebar-category.html", categories=categories, club=club) %}
					<!-- /sidebar category widget -->

					<div class="clearfix margin_top4"></div>

					<!-- sidebar popular widget -->
					{% module Template("elos/block-sidebar-popular.html", populars=populars, articles=articles) %}
					<!-- /sidebar popular widget -->

					<div class="clearfix margin_top5"></div>

				</div>
				<!-- end right sidebar -->

			</div>

			<div class="clearfix margin_top7"></div>

			<!-- footer -->
			{% module Template("elos/block-footer.html", club=club, categories=categories, articles=articles) %}
			<!-- footer -->

			<div class="clearfix"></div>

			<!-- copyright -->
			{% module Template("elos/block-copyright.html") %}
			<!-- copyright -->

			<a href="#" class="scrollup">Scroll</a>
			<!-- end scroll to top of the page-->

		</div>
	</div>


	<!-- ######### JS FILES ######### -->
	<script src="{{ static_url('elos/js/style-switcher/styleselector.js') }}"></script>
	<!-- SLIDER REVOLUTION 4.x SCRIPTS  -->
	<script type="text/javascript" src="{{ static_url('elos/js/revolutionslider/rs-plugin/js/jquery.themepunch.plugins.min.js') }}"></script>
	<script type="text/javascript" src="{{ static_url('elos/js/revolutionslider/rs-plugin/js/jquery.themepunch.revolution.min.js') }}"></script>
	<!-- mega menu -->
	<script src="{{ static_url('elos/js/mainmenu/bootstrap.min.js') }}"></script>
	<script src="{{ static_url('elos/js/mainmenu/fhmm.js') }}"></script>
	<!-- jquery jcarousel -->
	<script type="text/javascript" src="{{ static_url('elos/js/carousel/jquery.jcarousel.min.js') }}"></script>
	<!-- scroll up -->
	<script src="{{ static_url('elos/js/scrolltotop/totop.js') }}" type="text/javascript"></script>
	<!-- tabs -->
	<script src="{{ static_url('elos/js/tabs/assets/js/responsive-tabs.min.js') }}" type="text/javascript"></script>

	<!-- jquery jcarousel -->
	<script type="text/javascript">
		jQuery(document).ready(function() {
			jQuery('#mycarouselthree').jcarousel();
		});
	</script>
	<!-- accordion -->
	<script type="text/javascript" src="{{ static_url('elos/js/accordion/custom.js') }}"></script>
	<!-- REVOLUTION SLIDER -->
	<script type="text/javascript" src="{{ static_url('elos/js/revolutionslider/rs-plugin/js/custom.js') }}"></script>
	<!-- sticky menu -->
	<script type="text/javascript" src="{{ static_url('elos/js/mainmenu/sticky.js') }}"></script>
	<script type="text/javascript" src="{{ static_url('elos/js/mainmenu/modernizr.custom.75180.js') }}"></script>

	<!-- progress bar -->
	<script src="{{ static_url('elos/js/progressbar/progress.js') }}" type="text/javascript" charset="utf-8"></script>

	<!-- cubeportfolio -->
	<script type="text/javascript" src="{{ static_url('elos/js/cubeportfolio/jquery.cubeportfolio.min.js') }}"></script>
	<script type="text/javascript" src="{{ static_url('elos/js/cubeportfolio/main.js') }}"></script>
	<!-- carousel -->
	<script defer src="{{ static_url('elos/js/carousel/jquery.flexslider.js') }}"></script>
	<script defer src="{{ static_url('elos/js/carousel/custom.js') }}"></script>
	<!-- lightbox -->
	<script type="text/javascript" src="{{ static_url('elos/js/lightbox/jquery.fancybox.js') }}"></script>
	<script type="text/javascript" src="{{ static_url('elos/js/lightbox/custom.js') }}"></script>
	<script type="text/javascript" src="{{ static_url('js/json2.js') }}"></script>
	<script src="{{ static_url('weui/js/weui.js') }}"></script>
	<script src="{{ static_url('js/vue-2.1.4.js') }}" type="text/javascript"></script>
	<script type="text/javascript">
		// Menu drop down effect
		$('.dropdown-toggle').dropdownHover().dropdown();
		$(document).on('click', '.fhmm .dropdown-menu', function(e) {
			e.stopPropagation()
		});

		$(function(){
			function getLocalTime(nS) { //时间戳转换
				 var  d = new Date(parseInt(nS) * 1000);
				 var year = d.getFullYear();
				 var month = d.getMonth()+1;
				 var day = d.getDay();
				 var date_info = {"month":month+'月',"day":day+'日'};
				 return date_info;
			};
			var day = getLocalTime({{ article['publish_time'] }}).day;
			var month = getLocalTime({{ article['publish_time'] }}).month;
			$("#a_date").html("<strong>"+day+"</strong><i>"+ month +"</i>");

				$("#pub_btn").on("click",function(event){
					 event.preventDefault();
					  // weui.alert("123")
					weui.confirm("确定发布吗？","提示信息",function(r){
			      if(r == true){
			        publish("{{ article['_id'] }}");
			      }else{}
			    });

				});
				function publish(id){
			    console.log(id);
			    $.ajax({
			      type: "POST",
			      url: "{{ API_DOMAIN }}/api/articles/"+id+"/publish",
			      dataType: "json",
			      headers: {"Authorization":"Bearer {{access_token}}"},
			      contentType: 'application/json',
			      success: function(data, status, xhr) {
			          weui.Loading.success();
			          location.href = "/elos/clubs/{{ club['_id'] }}/articles/publish";
			      },
			      error: function(XMLHttpRequest, textStatus, errorThrown) {
			        console.log("XMLHttpRequest.status:" + XMLHttpRequest.status);
			        $('.lostpwd-form-main-message').addClass('error').html(XMLHttpRequest.status + ": 服务器异常,请稍后重试!");
			      },
			      complete: function(XMLHttpRequest, textStatus) {
			        this; // 调用本次AJAX请求时传递的options参数
			      }
			    });
			  };

			  function dele(id){
			    console.log(id);

			    $.ajax({
			      type: "DELETE",
			      url: "{{ API_DOMAIN }}/api/articles/"+id,
			      dataType: "json",
			      headers: {"Authorization":"Bearer {{access_token}}"},
			      contentType: 'application/json',
			      success: function(data, status, xhr) {
			        weui.Loading.success();
			        location.href = "/elos/clubs/{{ club['_id'] }}/articles/publish";
			      },
			      error: function(XMLHttpRequest, textStatus, errorThrown) {
			        console.log("XMLHttpRequest.status:" + XMLHttpRequest.status);
			          $('.lostpwd-form-main-message').addClass('error').html(XMLHttpRequest.status + ": 服务器异常,请稍后重试!");
			      },
			      complete: function(XMLHttpRequest, textStatus) {
			        this; // 调用本次AJAX请求时传递的options参数
			      }
			    });
			  };

			new Vue({
				el:'#comment_wrap',
				data: {
	        comments: [],
	        comment_num: 0,
	        limlt: 10
	      },
	      created: function() {
	        this.queryComments(0, this.limlt);
	      },
				methods:{
	        sendComment: function() {
	          var _self = this;
	          var comment = $("#comment").val();
	          console.log(comment);
	          var data = {
	            "comment": comment,
	          };
	          var json = JSON.stringify(data);
	          console.log(json);
	          function hide(){
	            $(".send-ok-message").hide(1000);
	          }
	          $.ajax({
	            type: "POST",
	            url: "{{ API_DOMAIN }}/api/articles/{{ article['_id'] }}/comment",
	            dataType: "json",
	            data: json,
	            contentType: 'application/json',
	            headers: {"Authorization":"Bearer {{access_token}}"},
	            success: function(data, status, xhr) {
	              console.log(data);
	              $("#comment").val("");
	              $(".send-ok-message").html("评论成功！");
	              setTimeout(hide,3000);
	              $("#comment").val("");
	              _self.queryNewComment();

	            },
	            error: function(XMLHttpRequest, textStatus, errorThrown) {
	              console.log("XMLHttpRequest.status:" + XMLHttpRequest.status);
	            },
	            complete: function(XMLHttpRequest, textStatus) {
	              this; // 调用本次AJAX请求时传递的options参数
	            }
	          });
	        },
	        loadMore: function() {
	          var _self = this;
	          $("#loadMoreBtn").text('加载中...');
	          _self.queryComments(_self.comment_num, _self.limlt);
	          setTimeout(function(){
	            if (_self.comment_num % _self.limlt == 0){
	              $("#loadMoreBtn").text('更多评论');
	            } else {
	              $("#loadMoreBtn").css('display','none');
	            }
	          }, 1000);
	          // setTimeout(function(){
	          //   $("#loadMoreBtn").css('display','none');
	          // }, 1000);
	        },
	        getLocalTime: function(nS) { //时间戳转换
	           return new Date(parseInt(nS) * 1000).toLocaleString().replace(/:\d{1,2}$/,' ');
	        },
	        queryComments: function(idx, limit) {
	          var _self = this;
	          $.ajax({
	            type: "GET",
	            url: "{{ API_DOMAIN }}/api/articles/{{ article['_id'] }}/comment?idx=" + idx + "&limit=" + limit,
	            async: false,
	            dataType: "json",
	            contentType: 'application/json',
	            success: function(datas, status, xhr) {
	              console.log(datas.rs);
	              for(var i = 0, l = datas.rs.length; i < l; i++) {
	                datas.rs[i].create_time = _self.getLocalTime(datas.rs[i].create_time);
	                // console.log(datas[i].create_time);
	                _self.comments.push(datas.rs[i]);
	                _self.comment_num += 1;
	              }
	            },
	            error: function(XMLHttpRequest, textStatus, errorThrown) {
	              console.log("XMLHttpRequest.status:" + XMLHttpRequest.status);
	            },
	            complete: function(XMLHttpRequest, textStatus) {
	              this; // 调用本次AJAX请求时传递的options参数
	            }
	          });
	        },
	        queryNewComment: function() {
	          var _self = this;
	          $.ajax({
	            type: "GET",
	            url: "{{ API_DOMAIN }}/api/articles/{{ article['_id'] }}/comment?idx=0&limit=1",
	            async: false,
	            dataType: "json",
	            contentType: 'application/json',
	            success: function(datas, status, xhr) {
	              console.log(datas.rs);
	              for(var i = 0, l = datas.rs.length; i < l; i++) {
	                datas.rs[i].create_time = _self.getLocalTime(datas.rs[i].create_time);
	                _self.comments.splice(0, 0, datas.rs[i]);
	                _self.comment_num += 1;
	              }
	            },
	            error: function(XMLHttpRequest, textStatus, errorThrown) {
	              console.log("XMLHttpRequest.status:" + XMLHttpRequest.status);
	            },
	            complete: function(XMLHttpRequest, textStatus) {
	              this; // 调用本次AJAX请求时传递的options参数
	            }
	          });
	        },
	      }
			});

		});
	</script>

</body>

</html>
