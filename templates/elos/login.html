<!doctype html>
<html lang="en-gb" class="no-js">
<!--<![endif]-->

<head>
	<title>{{ club['name'] }}</title>

	<meta charset="utf-8">
	<meta name="keywords" content="" />
	<meta name="description" content="" />

	<!-- Favicon -->
	<link rel="shortcut icon" href="images/favicon.ico">

	<!-- this styles only adds some repairs on idevices  -->
	<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1" />
	<!-- ######### CSS STYLES ######### -->
	<link rel="stylesheet" href="{{ static_url('elos/css/reset.css') }}" type="text/css" />
	<link rel="stylesheet" href="{{ static_url('elos/css/style.css') }}" type="text/css" />
	<link rel="stylesheet" href="{{ static_url('elos/css/font-awesome/css/font-awesome.min.css') }}">
	<!-- responsive devices styles -->
	<link rel="stylesheet" media="screen" href="{{ static_url('elos/css/responsive-leyouts.css') }}" type="text/css" />
	<!-- mega menu -->
	<link href="{{ static_url('elos/js/mainmenu/sticky.css') }}" rel="stylesheet">
	<link href="{{ static_url('elos/js/mainmenu/bootstrap.css') }}" rel="stylesheet">
	<link href="{{ static_url('elos/js/mainmenu/fhmm.css') }}" rel="stylesheet">
	<!-- forms -->
	<link rel="stylesheet" href="{{ static_url('elos/js/form/sky-forms.css') }}" type="text/css" media="all">
	<!-- Lightbox -->
	<link rel="stylesheet" type="text/css" href="{{ static_url('elos/js/lightbox/jquery.fancybox.css') }}" media="screen" />
	<script src="{{ static_url('elos/js/style-switcher/jquery-1.js') }}"></script>
</head>

<body>


	<div class="wrapper_boxed">

		<div class="site_wrapper">

			<!-- top header bar -->
			{% module Template("elos/block-header.html", club=club, categories=categories, is_login=is_login) %}
			<!-- /top header bar -->

			<div class="clearfix"></div>

			<!-- Contant ======================================= -->

			<div class="page_title2">
				<div class="container">
					<div class="title">
						<h1>登录页</h1></div>
					<div class="pagenation">&nbsp;<a href="/elos/clubs/{{ club['_id'] }}/blogs">首页</a> <i>/</i> 登录</div>
				</div>
			</div>
			<!-- end page title -->

			<div class="clearfix"></div>

			<div class="container">
				<div class="content_fullwidth">

					<div class="login_form">
						<form id="sky-form" class="sky-form" onsubmit="return false;">
							<header>登录</header>

							<fieldset>
								<section>
									<div class="row">
										<label class="label col col-4">手机号</label>
										<div class="col col-8">
											<label class="input">
												<i class="icon-append icon-user"></i>
												<input name="phone" id="lg_phone">
											</label>
										</div>
									</div>
								</section>

								<section>
									<div class="row">
										<label class="label col col-4">密码</label>
										<div class="col col-8">
											<label class="input">
												<i class="icon-append icon-lock"></i>
												<input type="password" name="password" id="lg_pwd">
											</label>
											<div class="note"><a href="#sky-form2" class="modal-opener">忘记密码?</a></div>
										</div>
									</div>
								</section>

								<section>
									<div class="row">
										<div class="col col-4"></div>
										<div class="col col-8">
											<label class="checkbox"><input type="checkbox" name="remember" checked><i></i>记住密码</label>
										</div>
									</div>
								</section>
							</fieldset>
							<footer>
								<div class="fright">
									<a href="register.html" class="button button-secondary">注册</a>
									<button type="submit" class="button">登录</button>
								</div>

							</footer>
						</form>
					</div>

					<form action="#" id="sky-form2" class="sky-form sky-form-modal">
						<header>密码找回</header>

						<fieldset>
							<section>
								<label class="label">注册邮箱</label>
								<label class="input">
									<i class="icon-append icon-user"></i>
									<input type="email" name="email" id="email">
								</label>
							</section>
						</fieldset>

						<footer>
							<button type="submit" name="submit" class="button">发送</button>
							<a href="#" class="button button-secondary modal-closer">关闭</a>
						</footer>

						<div class="message">
							<i class="icon-ok"></i>
							<p>Your request successfully sent!<br><a href="#" class="modal-closer">Close window</a></p>
						</div>
					</form>

				</div>

			</div>
			<!-- end content area -->

			<div class="clearfix margin_top7"></div>

			<!-- footer -->
			{% module Template("elos/block-footer.html", club=club, categories=categories, articles=articles) %}
			<!-- footer -->

			<div class="clearfix"></div>

			<!-- copyright -->
			{% module Template("elos/block-copyright.html") %}
			<!-- copyright -->

			<a href="#" class="scrollup">Scroll</a>
			<!-- end scroll to top of the page-->

		</div>
	</div>

	<!-- style switcher -->
	<script src="{{ static_url('elos/js/style-switcher/jquery-1.js') }}"></script>
	<script src="{{ static_url('elos/js/style-switcher/styleselector.js') }}"></script>
	<!-- mega menu -->
	<script src="{{ static_url('elos/js/mainmenu/bootstrap.min.js') }}"></script>
	<script src="{{ static_url('elos/js/mainmenu/fhmm.js') }}"></script>
	<!-- scroll up -->
	<script src="{{ static_url('elos/js/scrolltotop/totop.js') }}" type="text/javascript"></script>
	<!-- sticky menu -->
	<script type="text/javascript" src="{{ static_url('elos/js/mainmenu/sticky.js') }}"></script>
	<script type="text/javascript" src="{{ static_url('elos/js/mainmenu/modernizr.custom.75180.js') }}"></script>

	<script src="{{ static_url('elos/js/form/jquery.form.min.js') }}"></script>
	<script src="{{ static_url('elos/js/form/jquery.validate.min.js') }}"></script>
	<script src="{{ static_url('elos/js/form/jquery.modal.js') }}"></script>

	<!-- login -->
  <script type="text/javascript" src="{{ static_url('js/md5.min.js') }}"></script>
  <script type="text/javascript" src="{{ static_url('js/json2.js') }}"></script>

	<script type="text/javascript">
		$(function() {
			// Validation for login form
			$("#sky-form").validate({
				// Rules for form validation
				rules: {
					email: {
						required: true,
						email: true
					},
					password: {
						required: true,
						minlength: 6,
						maxlength: 20
					}
				},

				// Messages for form validation
				messages: {
					email: {
						required: '请输入手机号',
						email: '请输入正确的手机号'
					},
					password: {
						required: '请输入密码'
					}
				},

				// Do not change code below
				errorPlacement: function(error, element) {
					error.insertAfter(element.parent());
				},
				submitHandler: function(form) {
          console.log('login');

          var data = {
            action: 'login',
            login_type: 'phone',
            phone: $('#lg_phone').val(),
            pwd: $.md5($('#lg_pwd').val()),
          };
          var json = JSON.stringify(data);
          console.log(json);

          $.ajax({
            type: "POST",
            url: "http://7x24hs.com/api/auth/tokens",
            headers: {
              "Authorization": "Bearer eHfWk+OqSWaR7FhDTkW/d7TIZqP3q0W3nVGXKZY5A8Q="
            },
            data: json,
            dataType: "json",
            contentType: 'application/json',
            success: function(data, status, xhr) {
              // var rs_data = JSON.parse(data);
              console.log(data.err_code);
              if(data.err_code == 200){

              }
               else {
                $('.register-form-main-message').addClass('error').html('网络异常,刷新重试');
                return
              }
              // console.log("XMLHttpRequest.status++++++:"+ data.rs);
              var json = JSON.stringify(data.rs);
              console.log(json);

              // 登录成功后，注册入俱乐部
              $.ajax({
                type: "POST",
                url: "/club/auth/clubs/{{ club['_id'] }}/signup",
                data: json,
                dataType: "json",
                contentType: 'application/json',
                success: function(data, status, xhr) {

                },
                error: function(XMLHttpRequest, textStatus, errorThrown) {
                  console.log("XMLHttpRequest.status:" + XMLHttpRequest.status);
                },
                complete: function(XMLHttpRequest, textStatus) {
                  this; // 调用本次AJAX请求时传递的options参数
                }
              });

              location.href = "/";
            },
            error: function(XMLHttpRequest, textStatus, errorThrown) {
              console.log("XMLHttpRequest.status:" + XMLHttpRequest.status);
              if (XMLHttpRequest.status == 404) {
                $('.login-form-main-message').addClass('error').html('手机号码或密码不正确, 请重试');
              }
            },
            complete: function(XMLHttpRequest, textStatus) {
              this; // 调用本次AJAX请求时传递的options参数
            }
          });
        }
			});


			// Validation for recovery form
			$("#sky-form2").validate({
				// Rules for form validation
				rules: {
					email: {
						required: true,
						email: true
					}
				},

				// Messages for form validation
				messages: {
					email: {
						required: 'Please enter your email address',
						email: 'Please enter a VALID email address'
					}
				},

				// Ajax form submition
				submitHandler: function(form) {
					console.log(form);
					var data = {
            action: 'login',
            login_type: 'email',
            phone: $('#email').val(),
            pwd: $.md5($('#password').val()),
          };
          var json = JSON.stringify(data);
          console.log(json);

					$(form).ajaxSubmit({
						success: function() {
							$("#sky-form2").addClass('submited');
						}
					});
				},

				// Do not change code below
				errorPlacement: function(error, element) {
					error.insertAfter(element.parent());
				}
			});
		});
	</script>

	<!-- lightbox -->
	<script type="text/javascript" src="{{ static_url('elos/js/lightbox/jquery.fancybox.js') }}"></script>
	<script type="text/javascript" src="{{ static_url('elos/js/lightbox/custom.js') }}"></script>

	<script type="text/javascript">
		// Menu drop down effect
		$('.dropdown-toggle').dropdownHover().dropdown();
		$(document).on('click', '.fhmm .dropdown-menu', function(e) {
			e.stopPropagation()
		})
	</script>

</body>

</html>
